## Context
婚禮互動遊戲系統需要添加即時聊天功能，讓賓客能夠在活動期間交流祝福和感想。這是一個跨多個模組的功能，涉及前端組件、後端 API、資料庫設計和即時通信。

## Goals / Non-Goals
- Goals:
  - 提供簡單易用的即時聊天介面
  - 整合現有用戶認證系統
  - 支持多用戶同時在線
  - 提供訊息歷史記錄
  - 管理員可以審核和管理訊息

- Non-Goals:
  - 不支持私人訊息
  - 不支持檔案上傳
  - 不支持語音/視訊通話
  - 不支持表情符號自定義

## Decisions
- Decision: 使用 Supabase Realtime 作為即時通信基礎
  - 理由: 已經在專案中使用，減少外部依賴
  - 替代方案: WebSocket, Socket.io, Pusher

- Decision: 聊天室採用單一公共聊天室模式
  - 理由: 婚禮場景簡單，不需要複雜的房間管理
  - 替代方案: 多聊天室, 私人聊天室

- Decision: 訊息儲存在 PostgreSQL 資料庫
  - 理由: 與現有資料庫一致，便於管理
  - 替代方案: Redis, 專門的訊息隊列

- Decision: 前端使用 React 組件架構
  - 理由: 與現有技術棧一致
  - 替代方案: 獨立的聊天應用, 第三方聊天組件

## Risks / Trade-offs
- [即時性能風險] → 使用 Supabase Realtime，監控連接數和延遲
- [資料庫負擔] → 實施訊息分頁和清理策略
- [用戶體驗] → 簡化介面，專注於核心功能
- [管理複雜度] → 提供基本的管理工具，不過度設計

## Migration Plan
1. 創建新的資料庫表格
2. 部署後端 API
3. 逐步推出前端功能
4. 監控系統性能
5. 根據用戶反饋調整

回滾計劃：
- 可以通過功能開關禁用聊天功能
- 資料庫變更可以回滾
- API 端點可以獨立禁用

## Open Questions
- 訊息保留期限應該設定多久？
- 是否需要訊息審核機制？
- 如何處理不當內容？
- 是否需要用戶屏蔽功能？