## Context
當前婚禮遊戲應用的照片牆功能直接載入原始高解析度照片，在行動網路環境下導致載入緩慢、頻寬消耗大。用戶反饋顯示照片牆頁面載入時間過長，影響使用體驗。

## Goals / Non-Goals
- Goals: 
  - 減少照片牆初始載入時間 60-80%
  - 降低頻寬使用量
  - 提升行動設備用戶體驗
  - 保持圖片品質，支援查看原圖
- Non-Goals:
  - 不改變現有的照片上傳流程
  - 不影響現有照片的顯示邏輯
  - 不引入複雜的圖片編輯功能

## Decisions
- Decision: 使用 Sharp 庫進行伺服器端圖片處理
  - Reason: Sharp 性能優異，支援多種格式，Vercel 環境相容性好
  - Alternatives considered: JIMP (較慢但純 JavaScript), ImageMagick (過於複雜)
- Decision: 生成多種尺寸的縮圖 (小: 200px, 中: 400px, 大: 800px)
  - Reason: 適應不同螢幕尺寸和網路條件
  - Alternatives considered: 單一尺寸 (不夠靈活), 響應式生成 (延遲高)
- Decision: 在上傳時同步生成縮圖
  - Reason: 確保縮圖可用性，避免用戶等待
  - Alternatives considered: 按需生成 (首次載入慢), 背景任務 (複雜度高)

## Risks / Trade-offs
- [風險] 縮圖生成失敗 → 實施重試機制和回退到原圖
- [風險] 存儲空間增加 → 實施自動清理和壓縮最佳化
- [權衡] 處理時間 vs 品質 → 選擇平衡的壓縮參數
- [權衡] 即時生成 vs 預生成 → 選擇預生成確保一致性

## Migration Plan
1. **準備階段**: 備份現有資料庫，測試遷移腳本
2. **資料庫遷移**: 添加縮圖欄位，保持向後相容
3. **現有資料處理**: 批次生成現有照片的縮圖
4. **程式碼部署**: 逐步更新上傳和顯示邏輯
5. **驗證階段**: 測試所有功能，監控效能指標
6. **清理階段**: 移除舊的顯示邏輯，最佳化資料庫

**回滾計劃**: 保留原始圖片 URL，可快速回退到舊版本

## Open Questions
- 縮圖的過期策略如何設定？
- 是否需要實現縮圖的版本控制？
- 如何處理超大尺寸圖片的處理？
- 是否需要添加用戶手動重新生成縮圖的功能？