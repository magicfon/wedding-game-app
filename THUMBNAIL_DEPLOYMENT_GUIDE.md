# ç…§ç‰‡ç¸®åœ–ç³»çµ±éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•éƒ¨ç½²ç…§ç‰‡ç¸®åœ–ç³»çµ±åˆ°ç”Ÿç”¢ç’°å¢ƒï¼ŒåŒ…æ‹¬è³‡æ–™åº«é·ç§»ã€æ‡‰ç”¨ç¨‹å¼éƒ¨ç½²å’Œæ•ˆèƒ½ç›£æ§è¨­ç½®ã€‚

## ğŸ“‹ éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

### ç’°å¢ƒæº–å‚™
- [ ] Node.js 18+ å·²å®‰è£
- [ ] npm æˆ– yarn å·²å®‰è£
- [ ] Vercel CLI å·²å®‰è£ï¼ˆå¯é¸ï¼‰
- [ ] è³‡æ–™åº«è¨ªå•æ¬Šé™
- [ ] ç’°å¢ƒè®Šæ•¸å·²è¨­ç½®

### è³‡æ–™åº«æº–å‚™
- [ ] è³‡æ–™åº«å‚™ä»½å·²å®Œæˆ
- [ ] æ¸¬è©¦è³‡æ–™åº«å¯è¨ªå•æ€§
- [ ] é·ç§»è…³æœ¬å·²æº–å‚™

### æ‡‰ç”¨ç¨‹å¼æº–å‚™
- [ ] æ‰€æœ‰ä¾è³´å·²å®‰è£
- [ ] æ¸¬è©¦å·²é€šé
- [ ] æ§‹å»ºéç¨‹ç„¡éŒ¯èª¤
- [ ] ç’°å¢ƒè®Šæ•¸å·²é…ç½®

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. è³‡æ–™åº«é·ç§»

#### 1.1 å‚™ä»½ç¾æœ‰è³‡æ–™åº«
```bash
# ä½¿ç”¨ pg_dump å‚™ä»½ PostgreSQL
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql

# æˆ–ä½¿ç”¨ Supabase CLI
supabase db dump --db-url=$DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql
```

#### 1.2 åŸ·è¡Œç¸®åœ–æ”¯æ´é·ç§»
```bash
# åŸ·è¡Œä¸»è¦é·ç§»è…³æœ¬
psql $DATABASE_URL -f database/add-thumbnail-support.sql

# åŸ·è¡Œç¾æœ‰ç…§ç‰‡é·ç§»
psql $DATABASE_URL -f database/migrate-photos-to-thumbnails.sql

# åŸ·è¡Œå½±åƒæ•ˆèƒ½æ—¥èªŒé·ç§»
psql $DATABASE_URL -f database/add-image-performance-logging.sql
```

#### 1.3 é©—è­‰é·ç§»çµæœ
```sql
-- æª¢æŸ¥ç¸®åœ–æ¬„ä½æ˜¯å¦å·²æ·»åŠ 
\d photos

-- æª¢æŸ¥é·ç§»ç‹€æ…‹
SELECT * FROM check_thumbnail_migration_status();

-- æª¢æŸ¥å½±åƒæ•ˆèƒ½æ—¥èªŒè¡¨
\d image_performance_logs
```

### 2. æ‡‰ç”¨ç¨‹å¼éƒ¨ç½²

#### 2.1 å®‰è£ä¾è³´
```bash
npm install
# æˆ–
yarn install
```

#### 2.2 æ§‹å»ºæ‡‰ç”¨ç¨‹å¼
```bash
npm run build
# æˆ–
yarn build
```

#### 2.3 ç’°å¢ƒè®Šæ•¸è¨­ç½®
å‰µå»º `.env.production` æ–‡ä»¶ï¼š
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

#### 2.4 éƒ¨ç½²åˆ° Vercel
```bash
# ä½¿ç”¨ Vercel CLI
vercel --prod

# æˆ–é€šé Vercel å„€è¡¨æ¿ä¸Šå‚³ .next æ–‡ä»¶å¤¾
```

### 3. æ•ˆèƒ½ç›£æ§è¨­ç½®

#### 3.1 Vercel Analytics é…ç½®
åœ¨ Vercel å„€è¡¨æ¿ä¸­ï¼š
1. é€²å…¥é …ç›®è¨­ç½®
2. å•Ÿç”¨ Vercel Analytics
3. é…ç½®è‡ªå®šç¾©äº‹ä»¶ï¼ˆå¯é¸ï¼‰

#### 3.2 å½±åƒæ•ˆèƒ½ç›£æ§
ç³»çµ±æœƒè‡ªå‹•åˆå§‹åŒ–å½±åƒæ•ˆèƒ½ç›£æ§ï¼ŒåŒ…æ‹¬ï¼š
- åœ–ç‰‡è¼‰å…¥æ™‚é–“è¿½è¹¤
- è¨­å‚™é¡å‹æª¢æ¸¬
- ç¸®åœ–å°ºå¯¸æ•ˆèƒ½åˆ†æ
- éŒ¯èª¤ç‡ç›£æ§

## ğŸ”§ é…ç½®é¸é …

### ç¸®åœ–å°ºå¯¸é…ç½®
åœ¨ `src/lib/image-performance-init.ts` ä¸­èª¿æ•´ï¼š

```typescript
export const IMAGE_PERFORMANCE_CONFIG = {
  THUMBNAIL_SIZES: {
    small: { width: 200, quality: 75 },
    medium: { width: 400, quality: 80 },
    large: { width: 800, quality: 85 }
  },
  MONITORING: {
    SAMPLE_RATE: 0.1, // 10% æŠ½æ¨£
    MAX_LOG_ENTRIES: 1000,
    CLEANUP_INTERVAL: 5 * 60 * 1000 // 5 åˆ†é˜
  }
}
```

### ç›£æ§é…ç½®
```typescript
const tracker = initializeImagePerformanceMonitoring({
  enableVercelAnalytics: true, // ç”Ÿç”¢ç’°å¢ƒå•Ÿç”¨
  enableConsoleLogging: false, // ç”Ÿç”¢ç’°å¢ƒé—œé–‰
  enableCustomEndpoint: true,
  customEndpoint: '/api/analytics/image-performance',
  sampleRate: 0.1 // 10% æŠ½æ¨£
})
```

## ğŸ“Š æ•ˆèƒ½ç›£æ§

### æŸ¥çœ‹æ•ˆèƒ½æ•¸æ“š
1. è¨ªå•ç®¡ç†é¢æ¿ï¼š`/admin/image-performance`
2. æŸ¥çœ‹è©³ç´°çµ±è¨ˆï¼š
   - æŒ‰ç¸®åœ–å°ºå¯¸åˆ†çµ„çš„è¼‰å…¥æ™‚é–“
   - æŒ‰è¨­å‚™é¡å‹åˆ†çµ„çš„æˆåŠŸç‡
   - æŒ‰ç¶²è·¯æ¢ä»¶åˆ†çµ„çš„æ€§èƒ½æŒ‡æ¨™

### æ•ˆèƒ½å„ªåŒ–å»ºè­°
- å°å°ºå¯¸åœ–ç‰‡ï¼šç›®æ¨™è¼‰å…¥æ™‚é–“ < 500ms
- ä¸­ç­‰å°ºå¯¸åœ–ç‰‡ï¼šç›®æ¨™è¼‰å…¥æ™‚é–“ < 1000ms
- å¤§å°ºå¯¸åœ–ç‰‡ï¼šç›®æ¨™è¼‰å…¥æ™‚é–“ < 2000ms
- æ•´é«”æˆåŠŸç‡ï¼šç›®æ¨™ > 95%

## ğŸ§ª æ¸¬è©¦

### æœ¬åœ°æ¸¬è©¦
```bash
# é‹è¡Œå–®å…ƒæ¸¬è©¦
npm run test

# é‹è¡Œæ•ˆèƒ½æ¸¬è©¦
# è¨ªå• /debug/performance-test

# é‹è¡Œç¶²è·¯æ¸¬è©¦
# è¨ªå• /debug/network-test
```

### ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦
1. éƒ¨ç½²åˆ°æ¸¬è©¦ç’°å¢ƒ
2. é©—è­‰æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
3. é€²è¡Œè² è¼‰æ¸¬è©¦ï¼ˆå¯é¸ï¼‰
4. æª¢æŸ¥æ•ˆèƒ½æŒ‡æ¨™

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### è³‡æ–™åº«é·ç§»å¤±æ•—
```bash
# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
psql $DATABASE_URL -c "SELECT 1;"

# æª¢æŸ¥è¡¨çµæ§‹
\d photos

# æŸ¥çœ‹é·ç§»æ—¥èªŒ
SELECT * FROM migration_log ORDER BY started_at DESC;
```

#### åœ–ç‰‡è¼‰å…¥å¤±æ•—
1. æª¢æŸ¥åœ–ç‰‡ URL æ˜¯å¦æ­£ç¢º
2. é©—è­‰ Vercel Image Optimization é…ç½®
3. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯

#### æ•ˆèƒ½ç›£æ§ä¸å·¥ä½œ
1. ç¢ºèªç’°å¢ƒè®Šæ•¸è¨­ç½®
2. æª¢æŸ¥ç¶²è·¯è«‹æ±‚æ˜¯å¦æˆåŠŸ
3. é©—è­‰ API ç«¯é»æ˜¯å¦å¯è¨ªå•

### å›æ»¾ç¨‹åº
å¦‚æœéƒ¨ç½²å¤±æ•—ï¼Œå¯ä»¥åŸ·è¡Œå›æ»¾ï¼š

```bash
# å›æ»¾è³‡æ–™åº«è®Šæ›´
psql $DATABASE_URL -f database/rollback-thumbnail-support.sql

# å›æ»¾æ‡‰ç”¨ç¨‹å¼éƒ¨ç½²
vercel rollback [deployment-id]
```

## ğŸ“ˆ ç›£æ§å’Œç¶­è­·

### å®šæœŸä»»å‹™
å»ºè­°è¨­ç½®ä»¥ä¸‹å®šæœŸä»»å‹™ï¼š

1. **è³‡æ–™åº«æ¸…ç†**
   ```sql
   -- æ¸…ç†èˆŠçš„å½±åƒæ•ˆèƒ½æ—¥èªŒï¼ˆä¿ç•™ 90 å¤©ï¼‰
   SELECT cleanup_old_image_performance_logs(90);
   ```

2. **æ•ˆèƒ½å ±å‘Š**
   - æ¯é€±ç”Ÿæˆæ•ˆèƒ½å ±å‘Š
   - ç›£æ§ç•°å¸¸è¼‰å…¥æ™‚é–“
   - è¿½è¹¤éŒ¯èª¤ç‡è¶¨å‹¢

3. **å„²å­˜å„ªåŒ–**
   - å®šæœŸæ¸…ç†ä¸å¿…è¦çš„æª”æ¡ˆ
   - ç›£æ§å„²å­˜ç©ºé–“ä½¿ç”¨
   - å„ªåŒ–è³‡æ–™åº«æŸ¥è©¢

### è­¦å ±è¨­ç½®
å»ºè­°è¨­ç½®ä»¥ä¸‹è­¦å ±ï¼š

1. **é«˜éŒ¯èª¤ç‡è­¦å ±**
   - ç•¶åœ–ç‰‡è¼‰å…¥éŒ¯èª¤ç‡ > 5% æ™‚è§¸ç™¼

2. **æ…¢è¼‰å…¥æ™‚é–“è­¦å ±**
   - ç•¶å¹³å‡è¼‰å…¥æ™‚é–“è¶…éé æœŸå€¼æ™‚è§¸ç™¼

3. **å„²å­˜ç©ºé–“è­¦å ±**
   - ç•¶å¯ç”¨ç©ºé–“ < 20% æ™‚è§¸ç™¼

## ğŸ“š ç›¸é—œæ–‡æª”

- [ç…§ç‰‡ç¸®åœ–æŠ€è¡“è¨­è¨ˆ](./photo-wall-technical-design.md)
- [ç…§ç‰‡ç¸®åœ–å¯¦ç¾æŒ‡å—](./photo-wall-implementation-guide.md)
- [ç…§ç‰‡ç¸®åœ–é …ç›®ç¸½çµ](./photo-wall-project-summary.md)
- [è³‡æ–™åº«é·ç§»æŒ‡å—](./database/THUMBNAIL_MIGRATION_GUIDE.md)

## ğŸ†˜ æ”¯æ´

å¦‚æœé‡åˆ°éƒ¨ç½²å•é¡Œï¼Œè«‹ï¼š

1. æª¢æŸ¥æœ¬æ–‡æª”çš„æœ€æ–°ç‰ˆæœ¬
2. æŸ¥çœ‹é …ç›® GitHub Issues
3. è¯ç¹«æŠ€è¡“æ”¯æ´åœ˜éšŠ
4. æŸ¥çœ‹ç›¸é—œçš„éŒ¯èª¤æ—¥èªŒ

---

**æ³¨æ„ï¼š** åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­éƒ¨ç½²å‰ï¼Œè«‹å‹™å¿…åœ¨æ¸¬è©¦ç’°å¢ƒä¸­å®Œæ•´é©—è­‰æ‰€æœ‰åŠŸèƒ½ã€‚